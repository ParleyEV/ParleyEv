<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FutbolEv- ParleyEV</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { 
            --accent: #ff6b00; /* Naranja ParleyEV */
            --bg: #0a0a0a; 
            --card-bg: rgba(26, 26, 26, 0.45);
            --input-bg: #1a1a1a;
            --text-main: #ffffff;
            --green: #00ff88;
            --red: #ff4444;
            --neutral: #ffcc00;
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Segoe UI', Roboto, sans-serif; }

        body { 
            background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), url('../img/futbol.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: var(--text-main); 
            margin: 0; padding: 15px; display: flex; justify-content: center; min-height: 100vh;
        }

        .container { width: 100%; max-width: 450px; margin-top: 10px; }

        /* Estilo del T√≠tulo del Programa */
        .program-title {
            text-align: center;
            font-size: 2.2rem;
            font-weight: 900;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #ffffff;
        }

        .program-title span {
            color: var(--accent);
        }

        .program-title i {
            margin-right: 10px;
            font-size: 1.8rem;
            vertical-align: middle;
        }

        /* Estilo de Tarjetas Glass */
        .card { 
            background: var(--card-bg); padding: 24px; border-radius: 16px; 
            border: 1px solid rgba(255,255,255,0.1); 
            backdrop-filter: blur(12px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); margin-bottom: 20px;
        }

        label { font-size: 0.65rem; color: var(--accent); margin-bottom: 6px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; display: block; }
        
        input, select { 
            background: var(--input-bg); border: 1px solid #333; color: #fff; 
            padding: 12px; border-radius: 8px; outline: none; font-size: 14px; width: 100%;
            transition: 0.3s;
        }

        input:focus { border-color: var(--accent); }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; }

        /* Bot√≥n Principal de An√°lisis */
        .btn-main { 
            width: 100%; padding: 18px; 
            background: var(--accent);
            color: #fff; border: none; border-radius: 10px; 
            font-weight: 800; font-size: 1rem; text-transform: uppercase;
            cursor: pointer; transition: 0.3s;
            margin-bottom: 20px;
        }
        .btn-main:hover { transform: translateY(-2px); filter: brightness(1.1); }

        /* Estilos de los botones inferiores (Estilo P√°gina Principal) */
        .footer-links { display: flex; flex-direction: column; gap: 12px; margin-top: 30px; }
        
        .btn-link { 
            display: flex; align-items: center; justify-content: center; gap: 10px;
            width: 100%; padding: 14px; border-radius: 8px; font-weight: 700; 
            font-size: 0.85rem; text-decoration: none; text-transform: uppercase;
            transition: 0.3s; border: 2px solid transparent;
            backdrop-filter: blur(5px);
        }

        .btn-copy { border-color: #ffffff; color: #ffffff; background: rgba(255, 255, 255, 0.1); }
        .btn-triunfo { border-color: #ffcc00; color: #ffffff; background: rgba(255, 204, 0, 0.15); }
        .btn-tg { border-color: #0088cc; color: #ffffff; background: rgba(0, 136, 204, 0.15); }
        .btn-ig { border-color: #E1306C; color: #ffffff; background: rgba(225, 48, 108, 0.15); }

        .btn-link:hover { transform: translateY(-3px); background: rgba(255, 255, 255, 0.1); }

        /* Estilos de Resultados */
        .summary-card { padding: 20px; border-radius: 12px; margin: 20px 0; background: rgba(0,0,0,0.6); border: 1px solid #333; }
        .ev-item { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #222; }
        .ev-label { font-size: 0.7rem; text-transform: uppercase; color: #888; display: block; margin-bottom: 5px; }
        .ev-val { font-size: 1.4rem; font-weight: 800; display: block; }
        .stake-info { font-size: 0.85rem; font-weight: 700; margin-top: 5px; display: block; }

        .analysis-block { background: rgba(0,0,0,0.4); padding: 15px; border-radius: 12px; margin-bottom: 12px; border-left: 4px solid var(--accent); }
        .metric-row { display: flex; justify-content: space-between; align-items: flex-start; margin: 8px 0; font-size: 0.85rem; border-bottom: 1px solid #222; padding-bottom: 8px; }
        .metric-col { display: flex; flex-direction: column; align-items: flex-end; }
        .section-header { font-size: 0.7rem; color: var(--accent); font-weight: 800; text-transform: uppercase; margin: 20px 0 10px 0; letter-spacing: 1px; }

        /* Heatmap */
        .heat-bar-row { display: flex; align-items: center; background: rgba(255,255,255,0.03); border-radius: 6px; overflow: hidden; border: 1px solid rgba(255,255,255,0.05); height: 34px; margin-bottom: 5px; }
        .heat-bar-label { width: 50px; text-align: center; font-size: 0.75rem; font-weight: 800; background: #222; height: 100%; display: flex; align-items: center; justify-content: center; }
        .heat-bar-fill { height: 100%; display: flex; align-items: center; padding-left: 10px; font-size: 0.7rem; font-weight: bold; }

        /* Sliders */
        .slider-box { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; margin-top: 10px; border: 1px dashed #444; }
        input[type=range] { -webkit-appearance: none; background: #333; height: 6px; border-radius: 5px; width: 100%; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%; background: var(--accent); cursor: pointer; }
        
        .linea-titulo { font-size: 10px; text-align: center; margin-bottom: 5px; color: #888; }
    </style>
</head>
<body onload="loadSavedInputs()">

<div class="container">
    
    <h1 class="program-title"><i class="fas fa-futbol"></i>F√öTBOL<span>EV</span></h1>

    <div class="card">
        <label>Identificaci√≥n del Encuentro</label>
        <div class="grid-2">
            <div><label>Equipo Local</label><input type="text" id="n_loc_txt" placeholder="Local" oninput="autoSave()"></div>
            <div><label>Equipo Visita</label><input type="text" id="n_vis_txt" placeholder="Visita" oninput="autoSave()"></div>
        </div>
        <div class="grid-2" style="margin-top:10px">
            <div>
                <label>Nivel Local (Tier)</label>
                <select id="tier_l" onchange="autoSave()">
                    <option value="1.25">Elite</option>
                    <option value="1.15">Fuerte</option>
                    <option value="1.00" selected>Standard</option>
                    <option value="0.85">Regular</option>
                    <option value="0.70">Debil</option>
                </select>
            </div>
            <div>
                <label>Nivel Visita (Tier)</label>
                <select id="tier_v" onchange="autoSave()">
                    <option value="1.25">Elite</option>
                    <option value="1.15">Fuerte</option>
                    <option value="1.00" selected>Standard</option>
                    <option value="0.85">Regular</option>
                    <option value="0.70">Debil</option>
                </select>
            </div>
        </div>
        <div class="grid-2" style="margin-top:10px">
            <div>
                <label>Competici√≥n</label>
                <select id="sel_liga" onchange="autoSave()">
                    <option value="Premier League">Premier League</option>
                    <option value="La Liga">La Liga</option>
                    <option value="Bundesliga">Bundesliga</option>
                    <option value="Serie A">Serie A</option>
                    <option value="Ligue 1">Ligue 1</option>
                    <option value="Champions League">Champions League</option>
                    <option value="Europa League">Europa League</option>
                    <option value="Concacaf">Concacaf</option>
                    <option value="Amistoso">Amistoso</option>
                </select>
            </div>
            <div>
                <label>Fase / Jornada</label>
                <select id="sel_fase" onchange="autoSave()">
                    <option value="Jornada">Jornada</option>
                    <option value="8vos">8vos</option>
                    <option value="4tos">4tos</option>
                    <option value="Semifinal">Semifinal</option>
                    <option value="Final">Final</option>
                </select>
            </div>
        </div>
    </div>

    <div class="card">
        <label>Bankroll Disponible</label>
        <input type="number" id="bankroll" placeholder="Ej: 100" style="margin-bottom:15px" oninput="autoSave()">
        
        <label>Momios Americanos (1X2)</label>
        <div class="grid-3">
            <div><label>Local</label><input type="number" id="m_loc" oninput="autoSave()"></div>
            <div><label>Empate</label><input type="number" id="m_emp" oninput="autoSave()"></div>
            <div><label>Visita</label><input type="number" id="m_vis" oninput="autoSave()"></div>
        </div>

        <label style="margin-top:10px">Momios Americanos (Goles 2.5)</label>
        <div class="grid-2">
            <div><label>M√°s de 2.5</label><input type="number" id="m_over" oninput="autoSave()"></div>
            <div><label>Menos de 2.5</label><input type="number" id="m_under" oninput="autoSave()"></div>
        </div>
    </div>

    <div class="card">
        <label>An√°lisis de L√≠neas T√°cticas</label>
        <div class="grid-2">
            <div style="border-right: 1px solid #333; padding-right: 5px;">
                <div class="linea-titulo">LOCAL</div>
                <label>Ataque</label>
                <select id="atk_l" onchange="autoSave()" style="margin-bottom:8px">
                    <option value="1.15">Fuerte</option>
                    <option value="1" selected>S√≥lido</option>
                    <option value="0.85">D√©bil</option>
                </select>
                <label>Medio</label>
                <select id="med_l" onchange="autoSave()" style="margin-bottom:8px">
                    <option value="1.15">Fuerte</option>
                    <option value="1" selected>S√≥lido</option>
                    <option value="0.85">D√©bil</option>
                </select>
                <label>Defensa</label>
                <select id="def_l" onchange="autoSave()">
                    <option value="0.85">Fuerte</option>
                    <option value="1" selected>S√≥lido</option>
                    <option value="1.15">D√©bil</option>
                </select>
            </div>
            <div style="padding-left: 5px;">
                <div class="linea-titulo">VISITA</div>
                <label>Ataque</label>
                <select id="atk_v" onchange="autoSave()" style="margin-bottom:8px">
                    <option value="1.15">Fuerte</option>
                    <option value="1" selected>S√≥lido</option>
                    <option value="0.85">D√©bil</option>
                </select>
                <label>Medio</label>
                <select id="med_v" onchange="autoSave()" style="margin-bottom:8px">
                    <option value="1.15">Fuerte</option>
                    <option value="1" selected>S√≥lido</option>
                    <option value="0.85">D√©bil</option>
                </select>
                <label>Defensa</label>
                <select id="def_v" onchange="autoSave()">
                    <option value="0.85">Fuerte</option>
                    <option value="1" selected>S√≥lido</option>
                    <option value="1.15">D√©bil</option>
                </select>
            </div>
        </div>
    </div>

    <div class="card">
        <label>Historial Goles (√öltimos 5)</label>
        <div class="grid-2">
            <div><label>Local</label>
                <input type="text" id="h_l1" inputmode="decimal" placeholder="Goles-Recib" style="margin-bottom:5px" oninput="autoSave()">
                <input type="text" id="h_l2" inputmode="decimal" placeholder="Goles-Recib" style="margin-bottom:5px" oninput="autoSave()">
                <input type="text" id="h_l3" inputmode="decimal" placeholder="Goles-Recib" style="margin-bottom:5px" oninput="autoSave()">
                <input type="text" id="h_l4" inputmode="decimal" placeholder="Goles-Recib" style="margin-bottom:5px" oninput="autoSave()">
                <input type="text" id="h_l5" inputmode="decimal" placeholder="Goles-Recib" oninput="autoSave()">
                <select id="s_l" style="margin-top:10px" onchange="autoSave()"><option value="1">Neutral</option><option value="1.10">Ventaja</option><option value="0.90">Desventaja</option></select>
                <div class="slider-box">
                    <label style="font-size: 9px;">Volumen Juego: <span id="v_loc_val">100</span>%</label>
                    <input type="range" id="vol_l" min="50" max="100" value="100" oninput="document.getElementById('v_loc_val').innerText=this.value; autoSave()">
                </div>
            </div>
            <div><label>Visita</label>
                <input type="text" id="h_v1" inputmode="decimal" placeholder="Goles-Recib" style="margin-bottom:5px" oninput="autoSave()">
                <input type="text" id="h_v2" inputmode="decimal" placeholder="Goles-Recib" style="margin-bottom:5px" oninput="autoSave()">
                <input type="text" id="h_v3" inputmode="decimal" placeholder="Goles-Recib" style="margin-bottom:5px" oninput="autoSave()">
                <input type="text" id="h_v4" inputmode="decimal" placeholder="Goles-Recib" style="margin-bottom:5px" oninput="autoSave()">
                <input type="text" id="h_v5" inputmode="decimal" placeholder="Goles-Recib" oninput="autoSave()">
                <select id="s_v" style="margin-top:10px" onchange="autoSave()"><option value="1">Neutral</option><option value="1.10">Ventaja</option><option value="0.90">Desventaja</option></select>
                <div class="slider-box">
                    <label style="font-size: 9px;">Volumen Juego: <span id="v_vis_val">100</span>%</label>
                    <input type="range" id="vol_v" min="50" max="100" value="100" oninput="document.getElementById('v_vis_val').innerText=this.value; autoSave()">
                </div>
            </div>
        </div>

        <div class="slider-box">
            <label id="lbl_balanza">Balanza de Jerarqu√≠a: EQUILIBRADA</label>
            <input type="range" id="slider_balanza" min="-50" max="50" value="0" step="1" oninput="updateSliderLabel(this.value); autoSave()">
            <div style="display:flex; justify-content:space-between; font-size:10px; color:#666; margin-top:5px;">
                <span>LOCAL</span>
                <span>CENTRO</span>
                <span>VISITA</span>
            </div>
        </div>
    </div>

    <button class="btn-main" onclick="ejecutarAlgoritmo()">Iniciar An√°lisis</button>

    <div id="results"></div>

    <div class="footer-links">
        <button class="btn-link btn-copy" onclick="copyToClipboard()" id="copyBtn" style="display:none">
            <i class="fas fa-copy"></i> Copiar Reporte
        </button>
        <a href="https://triunfobet.com/register?r=TRI12603362" target="_blank" class="btn-link btn-triunfo">
            <i class="fas fa-gift"></i> Obt√©n un Bono en TriunfoBet
        </a>
        <a href="https://t.me/parleyev" target="_blank" class="btn-link btn-tg">
            <i class="fab fa-telegram-plane"></i> Pron√≥sticos Gratuitos
        </a>
        <a href="https://instagram.com/parleyevapp" target="_blank" class="btn-link btn-ig">
            <i class="fab fa-instagram"></i> Instagram
        </a>
    </div>

</div>

<script>
    // LA L√ìGICA DE JS SE MANTIENE INTACTA
    const inputIds = [
        'n_loc_txt', 'n_vis_txt', 'sel_liga', 'sel_fase', 'bankroll', 'tier_l', 'tier_v',
        'm_loc', 'm_emp', 'm_vis', 'm_over', 'm_under', 
        'atk_l', 'med_l', 'def_l', 'atk_v', 'med_v', 'def_v',
        'h_l1', 'h_l2', 'h_l3', 'h_l4', 'h_l5', 's_l', 'vol_l',
        'h_v1', 'h_v2', 'h_v3', 'h_v4', 'h_v5', 's_v', 'vol_v', 'slider_balanza'
    ];

    function autoSave() {
        const data = {};
        inputIds.forEach(id => {
            const el = document.getElementById(id);
            if(el) data[id] = el.value;
        });
        localStorage.setItem('parley_quantum_v3', JSON.stringify(data));
    }

    function loadSavedInputs() {
        const saved = localStorage.getItem('parley_quantum_v3');
        if (saved) {
            const data = JSON.parse(saved);
            inputIds.forEach(id => {
                const el = document.getElementById(id);
                if(el && data[id] !== undefined) {
                    el.value = data[id];
                    if(id === 'vol_l') document.getElementById('v_loc_val').innerText = el.value;
                    if(id === 'vol_v') document.getElementById('v_vis_val').innerText = el.value;
                }
            });
            const slider = document.getElementById('slider_balanza');
            if(slider) updateSliderLabel(slider.value);
        }
    }

    function factorial(n) { return (n <= 1) ? 1 : n * factorial(n - 1); }
    function poisson(l, k) { return (Math.pow(l, k) * Math.exp(-l)) / factorial(k); }
    function parse(s) { let p = s.split('-'); return {g: parseInt(p[0])||0, r: parseInt(p[1])||0}; }
    function amToDec(am) { return am > 0 ? (am / 100) + 1 : (100 / Math.abs(am)) + 1; }

    function updateSliderLabel(val) {
        const lbl = document.getElementById('lbl_balanza');
        const absVal = Math.abs(val);
        if(val < -10) lbl.innerText = "Balanza de Jerarqu√≠a: LOCAL (" + absVal + ")";
        else if(val > 10) lbl.innerText = "Balanza de Jerarqu√≠a: VISITA (" + absVal + ")";
        else lbl.innerText = "Balanza de Jerarqu√≠a: EQUILIBRADA";
    }

    function getThermalColor(prob, maxProb) {
        const ratio = prob / maxProb;
        if (ratio > 0.8) return "#ff0000";
        if (ratio > 0.6) return "#ff8c00";
        if (ratio > 0.4) return "#ffd700";
        if (ratio > 0.2) return "#00ced1";
        return "#1e90ff";
    }

    let lastResultText = "";

    function ejecutarAlgoritmo() {
        const bank = parseFloat(document.getElementById('bankroll').value) || 0;
        const nLoc = document.getElementById('n_loc_txt').value || "Local";
        const nVis = document.getElementById('n_vis_txt').value || "Visita";
        const liga = document.getElementById('sel_liga').value;
        const fase = document.getElementById('sel_fase').value;
        
        const mLocInput = document.getElementById('m_loc').value;
        const mEmpInput = document.getElementById('m_emp').value;
        const mVisInput = document.getElementById('m_vis').value;
        const mOvrInput = document.getElementById('m_over').value;
        const mUndInput = document.getElementById('m_under').value;

        const mLoc = parseFloat(mLocInput);
        const mEmp = parseFloat(mEmpInput);
        const mVis = parseFloat(mVisInput);
        const mOvr = parseFloat(mOvrInput);
        const mUnd = parseFloat(mUndInput);
        
        const tierL = parseFloat(document.getElementById('tier_l').value);
        const tierV = parseFloat(document.getElementById('tier_v').value);
        const volL = parseFloat(document.getElementById('vol_l').value) / 100;
        const volV = parseFloat(document.getElementById('vol_v').value) / 100;
        const balanzaVal = parseInt(document.getElementById('slider_balanza').value);

        if(isNaN(mLoc) || isNaN(mEmp) || isNaN(mVis)) return;

        let lA=0, lD=0, vA=0, vD=0;
        const w = [0.3, 0.25, 0.2, 0.15, 0.1];
        for(let i=1; i<=5; i++) {
            let dL = parse(document.getElementById(`h_l${i}`).value || "0-0");
            let dV = parse(document.getElementById(`h_v${i}`).value || "0-0");
            lA += dL.g * w[i-1]; lD += dL.r * w[i-1];
            vA += dV.g * w[i-1]; vD += dV.r * w[i-1];
        }

        let lamL = ((lA + vD)/2) * Math.pow(tierL, volL) * parseFloat(document.getElementById('s_l').value);
        let lamV = ((vA + lD)/2) * Math.pow(tierV, volV) * parseFloat(document.getElementById('s_v').value);

        if (balanzaVal < -5) {
            lamL *= (1 + (Math.abs(balanzaVal)/60));
            lamV *= (1 - (Math.abs(balanzaVal)/100));
        } else if (balanzaVal > 5) {
            lamV *= (1 + (balanzaVal/60));
            lamL *= (1 - (balanzaVal/100));
        }

        let lamL_Goles = lamL * parseFloat(document.getElementById('atk_l').value) * parseFloat(document.getElementById('def_v').value);
        let lamV_Goles = lamV * parseFloat(document.getElementById('atk_v').value) * parseFloat(document.getElementById('def_l').value);

        if(parseFloat(document.getElementById('med_l').value) > 1 && parseFloat(document.getElementById('med_v').value) > 1) {
            lamL_Goles *= 0.88; lamV_Goles *= 0.88;
        }

        let pLReal=0, pEReal=0, pVReal=0, pOver25=0;
        let exactScores = [];
        let maxProb = 0;

        for(let i=0; i<10; i++) {
            for(let j=0; j<10; j++) {
                let prWin = poisson(lamL_Goles, i) * poisson(lamV_Goles, j);
                if(i>j) pLReal+=prWin; else if(i===j) pEReal+=prWin; else pVReal+=prWin;
                if((i+j) > 2.5) pOver25 += prWin;
                if(i <= 4 && j <= 3) {
                    exactScores.push({ score: `${i}-${j}`, prob: prWin });
                    if(prWin > maxProb) maxProb = prWin;
                }
            }
        }

        const absX = Math.abs(balanzaVal);
        const fComp = Math.pow(absX, 2.3) / 15000;
        if(balanzaVal < 0) { pLReal += (1 - pLReal) * fComp; pVReal *= (1 - fComp); }
        else if(balanzaVal > 0) { pVReal += (1 - pVReal) * fComp; pLReal *= (1 - fComp); }
        pEReal = 1 - pLReal - pVReal;

        const dLoc = amToDec(mLoc), dEmp = amToDec(mEmp), dVis = amToDec(mVis);
        const dOvr = isNaN(mOvr) ? null : amToDec(mOvr);
        const dUnd = isNaN(mUnd) ? null : amToDec(mUnd);
        const dLE = 1 / ((1/dLoc) + (1/dEmp)) * 0.94;
        const dVE = 1 / ((1/dVis) + (1/dEmp)) * 0.94;

        let opciones = [
            {n: `Gana ${nLoc}`, p: pLReal, d: dLoc},
            {n: "Empate", p: pEReal, d: dEmp},
            {n: `Gana ${nVis}`, p: pVReal, d: dVis},
            {n: `${nLoc} o Empate`, p: pLReal + pEReal, d: dLE},
            {n: `${nVis} o Empate`, p: pVReal + pEReal, d: dVE}
        ];
        if(dOvr) opciones.push({n: "M√°s de 2.5 Goles", p: pOver25, d: dOvr});
        if(dUnd) opciones.push({n: "Menos de 2.5 Goles", p: 1 - pOver25, d: dUnd});

        let resHtml = `<div class="section-header">VALOR ESPERADO (EV) PRO</div><div class="summary-card">`;
        
        let copyText = `üèÜ ${liga} | ${fase}\n‚öΩ ${nLoc} vs ${nVis}\n--------------------------\n`;
        copyText += `üí∞ BANKROLL: ${bank}\n`;
        copyText += `üìâ MOMIOS: L:${mLocInput} | E:${mEmpInput} | V:${mVisInput}\n`;
        copyText += `‚öΩ GOLES: +2.5:${mOvrInput || 'N/A'} | -2.5:${mUndInput || 'N/A'}\n`;
        copyText += `--------------------------\n\n`;
        
        opciones.forEach(o => {
            let ev = (o.p * o.d) - 1;
            let valStake = (ev > 0) ? (bank * (ev / (o.d - 1)) / 10).toFixed(2) : "0.00";
            let color = (ev >= 0.05) ? "var(--green)" : (ev > 0 ? "var(--neutral)" : "var(--red)");
            let status = (ev >= 0.05) ? "Apostar con valor" : "No apostar";
            let probCasa = (1/o.d);
            let dif = (o.p - probCasa) * 100;

            resHtml += `<div class="ev-item"><span class="ev-label">${o.n}</span><span class="ev-val" style="color:${color}">${ev.toFixed(2)}</span><span class="stake-info" style="color:${color}">Stake: ${valStake} - ${status}</span></div>`;
            
            copyText += `‚Ä¢ ${o.n}\n  EV: ${ev.toFixed(2)} | Stake: ${valStake}\n  Prob Real: ${(o.p*100).toFixed(1)}% | ${status}\n  Diferencia: ${(dif > 0 ? '+' : '')}${dif.toFixed(1)}%\n\n`;
        });
        resHtml += `</div>`;

        exactScores.sort((a, b) => b.prob - a.prob);

        resHtml += `<div class="section-header">PANELES DE PROBABILIDAD (MARCADORES)</div><div class="analysis-block"><div class="heatmap-list">`;
        
        copyText += `üìä MAPA DE CALOR (TOP MARCADORES):\n`;
        exactScores.forEach((es, idx) => {
            let barWidth = (es.prob / maxProb) * 100;
            let cellColor = getThermalColor(es.prob, maxProb);
            resHtml += `
            <div class="heat-bar-row">
                <div class="heat-bar-label">${es.score}</div>
                <div class="heat-bar-fill" style="width: ${barWidth}%; background: ${cellColor}">
                    ${(es.prob*100).toFixed(1)}%
                </div>
            </div>`;
            if(idx < 5) copyText += `  [${es.score}] -> ${(es.prob*100).toFixed(1)}%\n`;
        });
        resHtml += `</div></div>`;

        resHtml += `<div class="section-header">AN√ÅLISIS DE PROBABILIDAD REAL</div><div class="analysis-block">`;
        opciones.forEach(o => {
            let probCasa = (1/o.d);
            let dif = (o.p - probCasa) * 100;
            let difColor = (dif > 5) ? "var(--green)" : (dif > 0 ? "var(--neutral)" : "var(--red)");
            resHtml += `
            <div class="metric-row">
                <span>${o.n}:</span>
                <div class="metric-col">
                    <b>${(o.p*100).toFixed(1)}%</b>
                    <span class="house-prob">Casa: ${(probCasa*100).toFixed(1)}%</span>
                    <span class="diff-val" style="color:${difColor}">${(dif > 0 ? '+' : '')}${dif.toFixed(1)}%</span>
                </div>
            </div>`;
        });
        resHtml += `</div>`;

        copyText += `\n--------------------------\nüìä AUDITOR√çA DE RESULTADO:\n${nLoc} [ ] vs [ ] ${nVis}\nEfectividad: %\nesperando resultado...\n--------------------------\n`;

        document.getElementById('results').innerHTML = resHtml;
        document.getElementById('copyBtn').style.display = 'block';
        lastResultText = copyText + `üß¨ Algoritmo: ParleyEV\n@parleyevapp`;
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    function copyToClipboard() {
        const el = document.createElement('textarea');
        el.value = lastResultText;
        document.body.appendChild(el);
        el.select();
        document.execCommand('copy');
        document.body.removeChild(el);
        const btn = document.getElementById('copyBtn');
        btn.innerText = "¬°Copiado!";
        setTimeout(() => btn.innerText = "Copiar Reporte", 2000);
    }
</script>
</body>
</html>